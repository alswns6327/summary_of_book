# 서버에서의 방화벽
서버를 새로 구축한 경우나 서비스를 오픈하였을때 우리는 연결 상태를 확인하기 위해서 테스트를 진행하게 된다.  
간혼 물리적 연결 및 서비스는 정상적으로 오픈 되어있으나 외부에서 접근을 할 수 없는 경우가 있는데 이런 경우에는 방화벽 정책이 어떻게 되어있는가를 확인해봐야한다.  

### 블랙리스트, 화이트리스트
방화벽 정책은 크게 블랙리스트 방식과 화이트리스트 방식으로 나뉘며, 블랙리스트의 경우 모든 통신을 열어둔 뒤 특정 IP나 포트로의 접근만을 막는 것이며, 화이트리스트의 경우에는 모든 접근을 차단한 뒤 특정 포트로의 접근이나 IP만을 열어두는 방식으로 대체로는 화이트리스트 방식을 사용한다.

### 리눅스에서의 방화벽 관리
리눅스에서는 iptables, firewalld, ufw를 사용하여 방화벽을 관리하며, CentOS의 경우 iptables, firewalld를 주로 사용하고 Ubuntu의 경우 ufw를 주로 사용하는 것으로 알고 있다.  
ufw의 경우 iptables의 프런트엔드 역할을 수행하는 것으로 결국에는 iptables의 이해도가 있으면 좋고 CentOS에서는 시스템상에서 7버전 부터 firewalld를 사용하는 것을 권장하는거 같으나 아직 iptables를 사용하는 유저가 많아 이 책에서는 iptables를 중점으로 설명한다.

### iptables와 netfilter의 관계
리눅스 커널은 커널에 내장된 netfilter 모듈을 사용해 실제 필터링을 진행하며, iptables도 결국에는 netfilter를 이용할 수 있게 만든 사용자 응용 프로그램으로 전체 관계도는 netfilter를 중심으로 뻗어나가는 것으로 보면 될 거 같다.

### iptables의 구조
iptables는 기본적으로 여러개의 테이블이 있으며, 방화벽 관련한 테이블은 Filter 테이블이라고 한다.  
하나의 테이블에는 여러개의 체인이 있고 각각의 체인은 다음과 같다.
* INPUT : 들어오는 통신에 대한 정책
* OUTPUT : 나가는 통신에 대한 정책
* FORWARD : 서버를 경우해서 가는 통신에 대한 정책
* PREROUTING : 라우팅 처리 전에 적용되는 정책
* POSTROUTING : 라우팅 처리 후에 적용되는 정책

즉 하나의 테이블 아래 여러 체인들이 있고 각각의 체인은 들어오고 나가는 통신에 대한 정책들을 가지고 있으며 저 체인들에 우리는 정책을 추가하고 빼며  서버 방화벽을 관리한다.  

---

***추가로 적자면 Linux의 기본 방화벽 정책은 화이트리스트 방식으로 모두 차단된 것이 기본 상태이다.***

책에서는 윈도우에 대한 방화벽 정책 내용도 있으나 크게 공부할 내용은 아닌거 같아서 굳이 적지는 않겠다.